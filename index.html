<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <title>IBONARIUM ¬∑ STATE VECTOR ¬∑ PLANETARY INDEX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        /* ------------------------------------------------------------------
           AESTHETIC: DEEP VOID & DATA DENSITY
           ------------------------------------------------------------------ */
        :root {
            --bg-deep: #020205;
            --accent-pri: #80f;
            --accent-sec: #0ff;
            --accent-warn: #f04;
            --white: #eef;
            --glass-panel: rgba(5, 5, 10, 0.7);
            --border-subtle: rgba(100, 100, 255, 0.1);
            --font-mono: 'Space Mono', monospace;
            --font-ui: 'Inter', sans-serif;
            --pad-outer: 40px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-deep);
            color: var(--white);
            font-family: var(--font-mono);
            overflow: hidden;
            height: 100vh;
            font-size: 10px;
        }

        canvas#bg-stars {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: 0.3;
        }

        .app-container {
            position: relative;
            z-index: 10;
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
            height: 100vh;
            padding: var(--pad-outer);
            max-width: 1920px;
            margin: 0 auto;
        }

        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 1px solid var(--border-subtle);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .brand-box {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .brand {
            font-size: 12px;
            letter-spacing: 6px;
            color: var(--accent-sec);
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .sub-brand {
            font-size: 9px;
            color: #668;
        }

        .col-left,
        .col-right {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .col-center {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid var(--border-subtle);
            background: radial-gradient(circle at center, rgba(20, 10, 30, 0.3), transparent 70%);
            border-radius: 4px;
        }

        .card {
            background: var(--glass-panel);
            border: 1px solid var(--border-subtle);
            backdrop-filter: blur(5px);
            padding: 12px;
            border-radius: 2px;
        }

        .card-h {
            font-size: 9px;
            color: var(--accent-sec);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            border-left: 2px solid var(--accent-pri);
            padding-left: 6px;
            display: flex;
            justify-content: space-between;
        }

        .m-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 9px;
        }

        .m-lbl {
            color: #779;
        }

        .m-val {
            color: #eef;
            font-weight: bold;
        }

        .m-unit {
            color: #556;
            font-size: 8px;
            margin-left: 2px;
        }

        .layer-box {
            background: rgba(255, 255, 255, 0.02);
            padding: 8px;
            margin-bottom: 8px;
            border-left: 3px solid;
        }

        .layer-space {
            border-color: #f80;
        }

        .layer-earth {
            border-color: #0af;
        }

        .layer-human {
            border-color: #f0f;
        }

        .layer-title {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        .layer-score {
            font-size: 18px;
            font-weight: bold;
        }

        canvas#viz-canvas {
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
        }

        .center-hud {
            position: absolute;
            bottom: 20px;
            left: 20px;
            pointer-events: none;
            text-align: left;
        }

        .big-idx {
            font-size: 52px;
            font-weight: 300;
            color: #fff;
            text-shadow: 0 0 30px var(--accent-pri);
            line-height: 1;
        }

        .idx-lbl {
            color: var(--accent-sec);
            font-size: 10px;
            letter-spacing: 2px;
        }

        .log-box {
            font-family: var(--font-ui);
            font-size: 9px;
            color: #88a;
            max-height: 150px;
            overflow-y: auto;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 4px;
            padding-left: 8px;
            border-left: 1px solid #333;
        }

        .log-time {
            color: #556;
            margin-right: 5px;
            font-family: var(--font-mono);
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #335;
        }

        /* ALERTS */
        #alert-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 320px;
        }

        .alert {
            background: rgba(0, 0, 0, 0.95);
            border-left: 4px solid;
            padding: 10px 12px;
            font-size: 9px;
            line-height: 1.4;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .alert-critical {
            border-color: #f04;
            color: #f04;
        }

        .alert-warning {
            border-color: #fa0;
            color: #fa0;
        }

        .alert-info {
            border-color: #0af;
            color: #0af;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .layer-desc {
            font-size: 8px;
            color: #88a;
            margin-top: 6px;
            line-height: 1.4;
            padding: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 2px;
        }

        @media (max-width: 1100px) {
            body {
                overflow-y: auto;
                height: auto;
            }

            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                padding: 10px;
                height: auto;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .col-left,
            .col-right {
                order: 2;
                overflow: visible;
                height: auto;
                padding: 0;
            }

            .col-center {
                order: 1;
                height: 50vh;
                margin: 5px 0;
                min-height: 350px;
            }

            :root {
                --pad-outer: 15px;
            }
        }
    </style>
</head>

<body>
    <canvas id="bg-stars"></canvas>
    <div id="alert-container"></div>

    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="brand-box">
                <div class="brand">IBONARIUM¬∑CHRONOS 7D¬∑MODULE.2.Situation.de.fait .LAVANDAAUDIT.PROJECT.2026</div>
                <div class="sub-brand">PLANETARY CONSCIOUSNESS INDEX ¬∑ MULTI-LAYER ANALYSIS</div>
            </div>
            <div style="text-align:right">
                <div style="font-size:20px; font-weight:bold; color:#fff;" id="clock-main">00:00:00</div>
                <div style="font-size:9px; color:#668;">UTC+2 (LOCAL)</div>
            </div>
        </div>

        <!-- LEFT COLUMN: SPACE & EARTH LAYERS -->
        <div class="col-left">
            <div class="card">
                <div class="card-h">
                    <span>‚òÄÔ∏è SPACE LAYER</span>
                    <span id="space-status">–°–ò–ù–•–†...</span>
                </div>
                <div class="layer-box layer-space">
                    <div class="layer-title">
                        <span>–ö–û–°–ú–Ü–ß–ù–ê –ù–ï–†–í–û–í–ê –°–ò–°–¢–ï–ú–ê</span>
                        <span class="layer-score" id="space-score">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Kp Index (–≥–µ–æ–º–∞–≥–Ω.)</span>
                        <span class="m-val" id="v-kp">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Solar Wind (–∫–º/—Å)</span>
                        <span class="m-val" id="v-sw-speed">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Density (p/cm¬≥)</span>
                        <span class="m-val" id="v-sw-dens">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Bz IMF (nT)</span>
                        <span class="m-val" id="v-bz">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Bt Total (nT)</span>
                        <span class="m-val" id="v-bt">--</span>
                    </div>
                    <div class="layer-desc" id="space-desc">
                        –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Å–º—ñ—á–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ...
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-h">
                    <span>üåç EARTH PHYSICAL LAYER</span>
                    <span id="earth-status">–°–ò–ù–•–†...</span>
                </div>
                <div class="layer-box layer-earth">
                    <div class="layer-title">
                        <span>–ü–õ–ê–ù–ï–¢–ê–†–ù–ï –¢–Ü–õ–û</span>
                        <span class="layer-score" id="earth-score">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Temperature (¬∞C)</span>
                        <span class="m-val" id="v-temp">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Pressure (hPa)</span>
                        <span class="m-val" id="v-press">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Humidity (%)</span>
                        <span class="m-val" id="v-hum">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Wind Speed (–º/—Å)</span>
                        <span class="m-val" id="v-wind">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">UV Index</span>
                        <span class="m-val" id="v-uv">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Air Quality (AQI)</span>
                        <span class="m-val" id="v-aqi">--</span>
                    </div>
                    <div class="layer-desc" id="earth-desc">
                        –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö...
                    </div>
                </div>
            </div>

            <div class="card" style="flex:1">
                <div class="card-h"><span>üìä WEIGHT MATRIX</span></div>
                <div style="font-size:8px; color:#668; line-height:1.6; font-family:var(--font-ui);">
                    <b style="color:#f80;">SPACE</b> = 0.35√óKp + 0.25√óSW_speed + 0.25√ó|Bz| + 0.15√óDensity<br>
                    <b style="color:#0af;">EARTH</b> = 0.30√óTempDev + 0.20√óPressDev + 0.20√óAQI + 0.15√óUV + 0.15√óWind<br>
                    <b style="color:#f0f;">HUMAN</b> = 0.40√óSentiment + 0.30√óMarket + 0.30√óSocial<br><br>
                    <b style="color:#80f;">IBONARIUM</b> = 0.4√óSPACE + 0.3√óEARTH + 0.3√óHUMAN
                </div>
            </div>
        </div>

        <!-- CENTER: VISUALIZATION -->
        <div class="col-center">
            <canvas id="viz-canvas"></canvas>

            <div class="center-hud">
                <div class="idx-lbl">IBONARIUM STATE VECTOR</div>
                <div class="big-idx" id="main-idx">--</div>
                <div style="font-size:10px; color:#aaa; margin-top:5px; max-width:280px; min-height:40px;"
                    id="main-desc">
                    –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –ë–ê–ì–ê–¢–û–®–ê–†–û–í–û–ì–û –ê–ù–ê–õ–Ü–ó–£...
                </div>
            </div>

            <div style="position:absolute; top:20px; right:20px; text-align:right;">
                <div style="font-size:9px; color:#88a;">REAL-TIME PLANETARY STATE</div>
                <div style="font-size:9px; color:#556;">3-LAYER FUSION MODEL</div>
                <div style="margin-top:8px;">
                    <span
                        style="display:inline-block; width:8px; height:8px; background:#f80; margin-right:4px;"></span>
                    <span style="font-size:9px; color:#fff;">SPACE</span>
                </div>
                <div>
                    <span
                        style="display:inline-block; width:8px; height:8px; background:#0af; margin-right:4px;"></span>
                    <span style="font-size:9px; color:#fff;">EARTH</span>
                </div>
                <div>
                    <span
                        style="display:inline-block; width:8px; height:8px; background:#f0f; margin-right:4px;"></span>
                    <span style="font-size:9px; color:#fff;">HUMAN</span>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: HUMAN LAYER & LOGS -->
        <div class="col-right">
            <div class="card">
                <div class="card-h">
                    <span>üß† HUMAN FIELD LAYER</span>
                    <span id="human-status">–°–ò–ù–•–†...</span>
                </div>
                <div class="layer-box layer-human">
                    <div class="layer-title">
                        <span>–ö–û–õ–ï–ö–¢–ò–í–ù–ê –ü–°–ò–•–Ü–ö–ê</span>
                        <span class="layer-score" id="human-score">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">News Sentiment</span>
                        <span class="m-val" id="v-sentiment">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Market Volatility</span>
                        <span class="m-val" id="v-market">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Social Entropy</span>
                        <span class="m-val" id="v-social">--</span>
                    </div>
                    <div class="m-row">
                        <span class="m-lbl">Conflict Proxy</span>
                        <span class="m-val" id="v-conflict">--</span>
                    </div>
                    <div class="layer-desc" id="human-desc">
                        –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö...
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-h"><span>üìà ANALYTICS</span></div>
                <div class="m-row">
                    <span class="m-lbl">24h Average</span>
                    <span class="m-val" id="m-avg">--</span>
                </div>
                <div class="m-row">
                    <span class="m-lbl">Peak Time</span>
                    <span class="m-val" id="m-peak">--:--</span>
                </div>
                <div class="m-row">
                    <span class="m-lbl">Deviation œÉ</span>
                    <span class="m-val" id="m-dev">--</span>
                </div>
                <div class="m-row">
                    <span class="m-lbl">Trend</span>
                    <span class="m-val" id="m-trend">--</span>
                </div>
            </div>

            <div class="card" style="flex:1; display:flex; flex-direction:column;">
                <div class="card-h"><span>üì° SYSTEM LOG</span></div>
                <div class="log-box" id="sys-log">
                    <!-- Logs -->
                </div>

                <div
                    style="margin-top:15px; padding-top:10px; border-top:1px solid #112; font-size:8px; color:#446; line-height:1.4; font-family:var(--font-ui);">
                    <div style="color:var(--accent-sec); margin-bottom:4px; font-weight:bold; letter-spacing:1px;">
                        IBONARIUM STATE VECTOR v2.0</div>
                    –Ü–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–æ—ó –ø–æ–¥—ñ—ó —á–µ—Ä–µ–∑ –±–∞–≥–∞—Ç–æ—à–∞—Ä–æ–≤—É –∞–≥—Ä–µ–≥–∞—Ü—ñ—é:<br><br>
                    <b style="color:#f80;">–ö–û–°–ú–û–°</b> ‚Äî –Ω–µ—Ä–≤–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ (–≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, —Å–æ–Ω—è—á–Ω–∏–π –≤—ñ—Ç–µ—Ä)<br>
                    <b style="color:#0af;">–ó–ï–ú–õ–Ø</b> ‚Äî —Ç—ñ–ª–æ (–∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, —Ñ—ñ–∑–∏—á–Ω—ñ —É–º–æ–≤–∏)<br>
                    <b style="color:#f0f;">–°–û–¶–Ü–£–ú</b> ‚Äî –ø—Å–∏—Ö—ñ–∫–∞ (–Ω–æ–≤–∏–Ω–∏, —Ä–∏–Ω–∫–∏, —Å–æ—Ü—ñ–∞–ª—å–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å)<br><br>
                    –û–Ω–æ–≤–ª–µ–Ω–Ω—è: –ö–æ—Å–º–æ—Å 1—Ö–≤, –ó–µ–º–ª—è 5—Ö–≤, –°–æ—Ü—ñ—É–º 10—Ö–≤
                </div>
            </div>
        </div>

    </div>

    <script>
        // ============================================================================
        // STATE & CONFIG
        // ============================================================================

        const STATE = {
            space: { kp: 0, sw_speed: 0, sw_dens: 0, bz: 0, bt: 0, score: 0 },
            earth: { temp: 0, press: 0, hum: 0, wind: 0, uv: 0, aqi: 0, score: 0 },
            human: { sentiment: 50, market: 0, social: 50, conflict: 0, score: 0 },
            ibonarium: 0,
            history: []
        };

        const MAX_HISTORY = 288; // 24h at 5min intervals

        // DOM
        const elLog = document.getElementById('sys-log');
        const elClock = document.getElementById('clock-main');
        const canvas = document.getElementById('viz-canvas');
        const ctx = canvas.getContext('2d');

        // ============================================================================
        // INIT & LOOPS
        // ============================================================================

        async function init() {
            mockHistory();
            updateParticles(); // Initialize particles based on initial metrics
            setInterval(tickClock, 1000);
            setInterval(fetchSpaceData, 60000); // 1 min
            setInterval(fetchEarthData, 300000); // 5 min
            setInterval(fetchHumanData, 600000); // 10 min
            requestAnimationFrame(animLoop);

            await Promise.all([fetchSpaceData(), fetchEarthData(), fetchHumanData()]);
            calculateIBONARIUM();
            updateParticles(); // Update after first data fetch
            log("IBONARIUM STATE VECTOR ONLINE");
        }

        function mockHistory() {
            const now = Date.now();
            for (let i = MAX_HISTORY; i > 0; i--) {
                const t = now - (i * 5 * 60 * 1000);
                const val = 50 + Math.sin(i / 20) * 20 + (Math.random() - 0.5) * 10;
                STATE.history.push({ t, val: Math.max(0, Math.min(100, val)) });
            }
        }

        // ============================================================================
        // DATA FETCHING
        // ============================================================================

        async function fetchSpaceData() {
            document.getElementById('space-status').innerText = 'FETCH...';
            try {
                const [plasma, mag, kp] = await Promise.all([
                    fetch('https://services.swpc.noaa.gov/products/solar-wind/plasma-5-minute.json')
                        .then(r => r.json())
                        .catch(() => fetch('https://corsproxy.io/?' + encodeURIComponent('https://services.swpc.noaa.gov/products/solar-wind/plasma-5-minute.json')).then(r => r.json())),
                    fetch('https://services.swpc.noaa.gov/products/solar-wind/mag-5-minute.json')
                        .then(r => r.json())
                        .catch(() => fetch('https://corsproxy.io/?' + encodeURIComponent('https://services.swpc.noaa.gov/products/solar-wind/mag-5-minute.json')).then(r => r.json())),
                    fetch('https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json')
                        .then(r => r.json())
                        .catch(() => fetch('https://corsproxy.io/?' + encodeURIComponent('https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json')).then(r => r.json()))
                ]);

                if (plasma && plasma.length > 1) {
                    const l = plasma[plasma.length - 1];
                    STATE.space.sw_dens = parseFloat(l[1]) || 5;
                    STATE.space.sw_speed = parseFloat(l[2]) || 400;
                }

                if (mag && mag.length > 1) {
                    const l = mag[mag.length - 1];
                    STATE.space.bz = parseFloat(l[3]) || 0;
                    STATE.space.bt = parseFloat(l[6]) || 5;
                }

                if (kp && kp.length > 1) {
                    STATE.space.kp = parseFloat(kp[kp.length - 1][1]) || 0;
                }

                // Calculate SPACE score (0-100)
                const kp_norm = Math.min(STATE.space.kp / 9, 1);
                const sw_norm = Math.min(STATE.space.sw_speed / 1000, 1);
                const bz_norm = Math.min(Math.abs(STATE.space.bz) / 25, 1);
                const dens_norm = Math.min(STATE.space.sw_dens / 50, 1);

                STATE.space.score = (
                    0.35 * kp_norm +
                    0.25 * sw_norm +
                    0.25 * bz_norm +
                    0.15 * dens_norm
                ) * 100;

                updateSpaceUI();
                log(`‚úì SPACE: Kp=${STATE.space.kp}, SW=${STATE.space.sw_speed.toFixed(0)} km/s`);
                document.getElementById('space-status').innerText = '–û–ù–õ–ê–ô–ù';
            } catch (e) {
                log('‚ö† SPACE LAYER OFFLINE');
                document.getElementById('space-status').innerText = 'OFFLINE';
            }
        }

        async function fetchEarthData() {
            document.getElementById('earth-status').innerText = 'FETCH...';
            try {
                // Using Kyiv as reference point
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=50.45&longitude=30.52&current=temperature_2m,relative_humidity_2m,surface_pressure,wind_speed_10m,uv_index&timezone=auto');
                const data = await res.json();

                STATE.earth.temp = data.current.temperature_2m || 15;
                STATE.earth.hum = data.current.relative_humidity_2m || 60;
                STATE.earth.press = data.current.surface_pressure || 1013;
                STATE.earth.wind = data.current.wind_speed_10m || 3;
                STATE.earth.uv = data.current.uv_index || 2;
                STATE.earth.aqi = 50; // Mock AQI (need separate API)

                // Calculate EARTH score
                const temp_dev = Math.abs(STATE.earth.temp - 15) / 30; // deviation from 15¬∞C
                const press_dev = Math.abs(STATE.earth.press - 1013) / 50;
                const aqi_norm = STATE.earth.aqi / 200;
                const uv_norm = STATE.earth.uv / 11;
                const wind_norm = STATE.earth.wind / 20;

                STATE.earth.score = (
                    0.30 * temp_dev +
                    0.20 * press_dev +
                    0.20 * aqi_norm +
                    0.15 * uv_norm +
                    0.15 * wind_norm
                ) * 100;

                updateEarthUI();
                log(`‚úì EARTH: T=${STATE.earth.temp.toFixed(1)}¬∞C, P=${STATE.earth.press.toFixed(0)}hPa`);
                document.getElementById('earth-status').innerText = '–û–ù–õ–ê–ô–ù';
            } catch (e) {
                log('‚ö† EARTH LAYER OFFLINE');
                document.getElementById('earth-status').innerText = 'OFFLINE';
            }
        }

        async function fetchHumanData() {
            document.getElementById('human-status').innerText = 'FETCH...';
            try {
                // News Sentiment
                const newsRes = await fetch('https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/news/world/rss.xml');
                const newsData = await newsRes.json();

                let fearWords = ['war', 'dead', 'kill', 'crisis', 'crash', 'attack', 'threat', 'death', 'conflict'];
                let hopeWords = ['peace', 'win', 'new', 'safe', 'good', 'growth', 'deal', 'help'];
                let fearCount = 0, hopeCount = 0;

                newsData.items.slice(0, 10).forEach(item => {
                    const txt = (item.title + " " + item.description).toLowerCase();
                    fearWords.forEach(w => { if (txt.includes(w)) fearCount++; });
                    hopeWords.forEach(w => { if (txt.includes(w)) hopeCount++; });
                });

                STATE.human.sentiment = clamp(50 - (fearCount * 5) + (hopeCount * 3), 0, 100);

                // Market Volatility (Bitcoin as proxy)
                const btcRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const btcData = await btcRes.json();
                STATE.human.market = Math.abs(btcData.bitcoin.usd_24h_change || 2);

                // Social Entropy (simulated from news count)
                STATE.human.social = clamp(newsData.items.length * 2, 0, 100);
                STATE.human.conflict = fearCount * 5;

                // Calculate HUMAN score
                const sent_norm = (100 - STATE.human.sentiment) / 100; // inverted
                const market_norm = Math.min(STATE.human.market / 20, 1);
                const social_norm = STATE.human.social / 100;

                STATE.human.score = (
                    0.40 * sent_norm +
                    0.30 * market_norm +
                    0.30 * social_norm
                ) * 100;

                updateHumanUI();
                log(`‚úì HUMAN: Sentiment=${STATE.human.sentiment.toFixed(0)}, Market=${STATE.human.market.toFixed(1)}%`);
                document.getElementById('human-status').innerText = '–û–ù–õ–ê–ô–ù';
            } catch (e) {
                log('‚ö† HUMAN LAYER OFFLINE');
                document.getElementById('human-status').innerText = 'OFFLINE';
            }
        }

        function calculateIBONARIUM() {
            STATE.ibonarium = (
                0.4 * STATE.space.score +
                0.3 * STATE.earth.score +
                0.3 * STATE.human.score
            );

            STATE.history.push({ t: Date.now(), val: STATE.ibonarium });
            if (STATE.history.length > MAX_HISTORY) STATE.history.shift();

            updateMainUI();
            updateParticles(); // Update visualization based on new metrics
        }

        // ============================================================================
        // UI UPDATES
        // ============================================================================

        function updateSpaceUI() {
            document.getElementById('v-kp').innerText = STATE.space.kp.toFixed(2);
            document.getElementById('v-sw-speed').innerText = STATE.space.sw_speed.toFixed(0);
            document.getElementById('v-sw-dens').innerText = STATE.space.sw_dens.toFixed(1);
            document.getElementById('v-bz').innerText = STATE.space.bz.toFixed(2);
            document.getElementById('v-bt').innerText = STATE.space.bt.toFixed(2);
            document.getElementById('space-score').innerText = STATE.space.score.toFixed(0);
            document.getElementById('space-score').style.color = getScoreColor(STATE.space.score);
        }

        function updateEarthUI() {
            document.getElementById('v-temp').innerText = STATE.earth.temp.toFixed(1);
            document.getElementById('v-press').innerText = STATE.earth.press.toFixed(0);
            document.getElementById('v-hum').innerText = STATE.earth.hum.toFixed(0);
            document.getElementById('v-wind').innerText = STATE.earth.wind.toFixed(1);
            document.getElementById('v-uv').innerText = STATE.earth.uv.toFixed(1);
            document.getElementById('v-aqi').innerText = STATE.earth.aqi.toFixed(0);
            document.getElementById('earth-score').innerText = STATE.earth.score.toFixed(0);
            document.getElementById('earth-score').style.color = getScoreColor(STATE.earth.score);
        }

        function updateHumanUI() {
            document.getElementById('v-sentiment').innerText = STATE.human.sentiment.toFixed(0);
            document.getElementById('v-market').innerText = STATE.human.market.toFixed(1) + '%';
            document.getElementById('v-social').innerText = STATE.human.social.toFixed(0);
            document.getElementById('v-conflict').innerText = STATE.human.conflict.toFixed(0);
            document.getElementById('human-score').innerText = STATE.human.score.toFixed(0);
            document.getElementById('human-score').style.color = getScoreColor(STATE.human.score);
        }

        function updateMainUI() {
            const idx = STATE.ibonarium;
            document.getElementById('main-idx').innerText = idx.toFixed(1);
            document.getElementById('main-idx').style.color = getScoreColor(idx);

            let mood = "";
            if (idx < 30) mood = "–ö–†–ò–¢–ò–ß–ù–ò–ô –°–¢–ê–ù";
            else if (idx < 50) mood = "–ù–ê–ü–†–£–ñ–ï–ù–ù–Ø";
            else if (idx < 70) mood = "–°–¢–ê–ë–Ü–õ–¨–ù–Ü–°–¢–¨";
            else mood = "–ì–ê–†–ú–û–ù–Ü–Ø";

            document.getElementById('main-desc').innerHTML = `<span style="color:#fff; font-weight:bold">${mood}</span> // –Ü–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–æ—ó –ø–æ–¥—ñ—ó`;

            // Analytics
            const vals = STATE.history.map(h => h.val);
            const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
            const dev = Math.sqrt(vals.map(v => Math.pow(v - avg, 2)).reduce((a, b) => a + b, 0) / vals.length);
            const trend = vals[vals.length - 1] > vals[vals.length - 10] ? '‚Üó –ó–†–û–°–¢–ê–ù–ù–Ø' : '‚Üò –°–ü–ê–î';

            document.getElementById('m-avg').innerText = avg.toFixed(1);
            document.getElementById('m-dev').innerText = dev.toFixed(1);
            document.getElementById('m-trend').innerText = trend;
            document.getElementById('m-peak').innerText = new Date().toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
        }

        function getScoreColor(score) {
            if (score < 30) return '#f04';
            if (score < 50) return '#fa0';
            if (score < 70) return '#ff0';
            return '#0fa';
        }

        // ============================================================================
        // DATA-DRIVEN VISUALIZATION - REACTIVE TO METRICS
        // ============================================================================

        let rotationAngle = 0;
        let particles = [];
        let lastMetricsUpdate = 0;

        // Initialize particles based on current metrics
        function updateParticles() {
            // Particle count based on Kp index (0-9 -> 50-300 particles)
            const targetCount = Math.floor(50 + STATE.space.kp * 25);

            // Add particles if needed
            while (particles.length < targetCount) {
                particles.push(createParticle());
            }

            // Remove particles if needed
            while (particles.length > targetCount) {
                particles.pop();
            }

            // Update particle properties based on metrics
            particles.forEach(p => {
                // Speed based on solar wind (300-1000 km/s -> 0.005-0.03)
                p.baseSpeed = 0.005 + (STATE.space.sw_speed / 1000) * 0.025;

                // Color based on temperature (-20 to +40 -> blue to red)
                const tempNorm = (STATE.earth.temp + 20) / 60;
                p.color = tempToColor(tempNorm);

                // Size based on pressure deviation
                const pressDeviation = Math.abs(STATE.earth.press - 1013) / 50;
                p.sizeMultiplier = 1 + pressDeviation * 0.5;
            });
        }

        function createParticle() {
            return {
                angle: Math.random() * Math.PI * 2,
                radius: Math.random() * 250 + 30,
                z: Math.random() * 500 - 250,
                baseSpeed: 0.01,
                speed: 0.01,
                size: Math.random() * 2 + 1,
                sizeMultiplier: 1,
                color: 'rgba(136, 0, 255, 0.6)',
                turbulence: 0
            };
        }

        function tempToColor(norm) {
            const r = Math.floor(norm * 255);
            const b = Math.floor((1 - norm) * 255);
            const g = 100;
            return `rgba(${r}, ${g}, ${b}, 0.6)`;
        }

        function animLoop() {
            rotationAngle += 0.003;

            // Update particles every minute based on new metrics
            const now = Date.now();
            if (now - lastMetricsUpdate > 60000) {
                updateParticles();
                lastMetricsUpdate = now;
            }

            drawVisualization();
            requestAnimationFrame(animLoop);
        }

        function drawVisualization() {
            const w = canvas.clientWidth;
            const h = canvas.clientHeight;
            if (canvas.width !== w) { canvas.width = w; canvas.height = h; }

            ctx.clearRect(0, 0, w, h);

            const cx = w / 2;
            const cy = h / 2;
            const maxR = Math.min(w, h) * 0.35;

            // 3D projection helper
            function project3D(x, y, z) {
                const fov = 500;
                const scale = fov / (fov + z);
                return {
                    x: cx + x * scale,
                    y: cy + y * scale,
                    scale: scale
                };
            }

            // Wind turbulence effect
            const windTurbulence = STATE.earth.wind / 20;

            // Draw particles with metric-based behavior
            particles.forEach(p => {
                // Update angle with base speed + turbulence
                p.angle += p.baseSpeed + Math.sin(rotationAngle * 5) * windTurbulence * 0.01;

                // Radius oscillation based on sentiment (nervous system)
                const sentimentWave = Math.sin(rotationAngle * 3 + p.angle) * (100 - STATE.human.sentiment) / 100 * 20;
                const currentRadius = p.radius + sentimentWave;

                const x = Math.cos(p.angle + rotationAngle) * currentRadius;
                const y = Math.sin(p.angle + rotationAngle) * currentRadius;

                // Z-axis movement based on Bz (magnetic field)
                p.z += Math.sin(rotationAngle * 2) * Math.abs(STATE.space.bz) * 0.5;
                if (p.z > 250) p.z = -250;
                if (p.z < -250) p.z = 250;

                const proj = project3D(x, y, p.z);

                ctx.fillStyle = p.color;
                ctx.globalAlpha = proj.scale * 0.7;
                ctx.beginPath();
                ctx.arc(proj.x, proj.y, p.size * p.sizeMultiplier * proj.scale, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;

            // Draw data-driven layers
            const layers = [
                {
                    radius: maxR * 1.0,
                    score: STATE.space.score,
                    color: '#f80',
                    label: 'SPACE',
                    z: 0,
                    metric: STATE.space.kp,
                    maxMetric: 9
                },
                {
                    radius: maxR * 0.7,
                    score: STATE.earth.score,
                    color: '#0af',
                    label: 'EARTH',
                    z: -50,
                    metric: Math.abs(STATE.earth.press - 1013),
                    maxMetric: 50
                },
                {
                    radius: maxR * 0.4,
                    score: STATE.human.score,
                    color: '#f0f',
                    label: 'HUMAN',
                    z: -100,
                    metric: STATE.human.market,
                    maxMetric: 20
                }
            ];

            layers.forEach(layer => {
                const segments = 64;

                // Pulsation based on metric intensity
                const pulse = Math.sin(rotationAngle * 4) * (layer.metric / layer.maxMetric) * 10;
                const activeRadius = layer.radius + pulse;

                for (let i = 0; i < segments; i++) {
                    const angle1 = (i / segments) * Math.PI * 2 + rotationAngle;
                    const angle2 = ((i + 1) / segments) * Math.PI * 2 + rotationAngle;

                    // Deformation based on score (lower score = more distortion)
                    const distortion1 = Math.sin(angle1 * 3) * (100 - layer.score) / 100 * 15;
                    const distortion2 = Math.sin(angle2 * 3) * (100 - layer.score) / 100 * 15;

                    const x1 = Math.cos(angle1) * (activeRadius + distortion1);
                    const y1 = Math.sin(angle1) * (activeRadius + distortion1);
                    const x2 = Math.cos(angle2) * (activeRadius + distortion2);
                    const y2 = Math.sin(angle2) * (activeRadius + distortion2);

                    const p1 = project3D(x1, y1, layer.z);
                    const p2 = project3D(x2, y2, layer.z);

                    const progress = i / segments;
                    const alpha = progress < (layer.score / 100) ? 0.9 : 0.15;

                    // Intensity flicker based on metric
                    const flicker = 1 + Math.sin(rotationAngle * 10 + i) * (layer.metric / layer.maxMetric) * 0.2;

                    ctx.strokeStyle = layer.color + Math.floor(alpha * flicker * 255).toString(16).padStart(2, '0');
                    ctx.lineWidth = 3 * p1.scale;
                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }

                // Layer label with glow based on activity
                const labelAngle = rotationAngle;
                const lx = Math.cos(labelAngle) * (layer.radius + 25);
                const ly = Math.sin(labelAngle) * (layer.radius + 25);
                const lp = project3D(lx, ly, layer.z);

                const glowIntensity = 10 + (layer.metric / layer.maxMetric) * 20;
                ctx.shadowBlur = glowIntensity;
                ctx.shadowColor = layer.color;
                ctx.fillStyle = '#fff';
                ctx.font = (10 * lp.scale) + 'px Space Mono';
                ctx.textAlign = 'center';
                ctx.fillText(layer.label, lp.x, lp.y);
                ctx.shadowBlur = 0;
            });

            // Connection lines between layers based on correlation
            if (STATE.space.score > 0 && STATE.earth.score > 0) {
                const correlation = Math.abs(STATE.space.score - STATE.earth.score) / 100;
                ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - correlation)})`;
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);

                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2 + rotationAngle;
                    const x1 = Math.cos(angle) * maxR * 1.0;
                    const y1 = Math.sin(angle) * maxR * 1.0;
                    const x2 = Math.cos(angle) * maxR * 0.7;
                    const y2 = Math.sin(angle) * maxR * 0.7;

                    const p1 = project3D(x1, y1, 0);
                    const p2 = project3D(x2, y2, -50);

                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }
                ctx.setLineDash([]);
            }

            // History graph at bottom
            drawHistory();
        }

        function drawHistory() {
            const w = canvas.width;
            const h = canvas.height;
            const graphH = h * 0.15;
            const graphY = h - graphH - 20;

            if (STATE.history.length < 2) return;

            ctx.strokeStyle = '#80f';
            ctx.lineWidth = 2;
            ctx.beginPath();

            STATE.history.forEach((pt, i) => {
                const x = (i / (STATE.history.length - 1)) * w;
                const y = graphY + graphH - (pt.val / 100) * graphH;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });

            ctx.stroke();

            // Grid
            ctx.strokeStyle = '#ffffff11';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = graphY + (i / 4) * graphH;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
        }

        // ============================================================================
        // ALERT SYSTEM
        // ============================================================================

        const alertContainer = document.getElementById('alert-container');
        const activeAlerts = new Set();

        function showAlert(message, type = 'info', duration = 8000) {
            const alertKey = `${type}-${message}`;
            if (activeAlerts.has(alertKey)) return;

            activeAlerts.add(alertKey);

            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `<b>${type.toUpperCase()}:</b> ${message}`;
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    alertContainer.removeChild(alert);
                    activeAlerts.delete(alertKey);
                }, 300);
            }, duration);
        }

        function checkAlerts() {
            // SPACE alerts
            if (STATE.space.kp > 6) {
                showAlert(`–ì–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–∏–π —à—Ç–æ—Ä–º! Kp=${STATE.space.kp.toFixed(1)} (–∫—Ä–∏—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å)`, 'critical');
            } else if (STATE.space.kp > 4) {
                showAlert(`–ü—ñ–¥–≤–∏—â–µ–Ω–∞ –≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: Kp=${STATE.space.kp.toFixed(1)}`, 'warning');
            }

            if (STATE.space.sw_speed > 700) {
                showAlert(`–ï–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏–π —Å–æ–Ω—è—á–Ω–∏–π –≤—ñ—Ç–µ—Ä: ${STATE.space.sw_speed.toFixed(0)} –∫–º/—Å`, 'critical');
            } else if (STATE.space.sw_speed > 550) {
                showAlert(`–í–∏—Å–æ–∫–æ—à–≤–∏–¥–∫—ñ—Å–Ω–∏–π –ø–æ—Ç—ñ–∫: ${STATE.space.sw_speed.toFixed(0)} –∫–º/—Å`, 'warning');
            }

            if (Math.abs(STATE.space.bz) > 15) {
                showAlert(`–ö—Ä–∏—Ç–∏—á–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è Bz: ${STATE.space.bz.toFixed(1)} nT`, 'critical');
            }

            // EARTH alerts
            if (STATE.earth.wind > 15) {
                showAlert(`–°–∏–ª—å–Ω–∏–π –≤—ñ—Ç–µ—Ä: ${STATE.earth.wind.toFixed(1)} –º/—Å`, 'warning');
            }

            if (STATE.earth.press < 980 || STATE.earth.press > 1040) {
                showAlert(`–ê–Ω–æ–º–∞–ª—å–Ω–∏–π —Ç–∏—Å–∫: ${STATE.earth.press.toFixed(0)} hPa`, 'warning');
            }

            // HUMAN alerts
            if (STATE.human.sentiment < 30) {
                showAlert(`–ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑—å–∫–∏–π —Å–æ—Ü—ñ–∞–ª—å–Ω–∏–π –Ω–∞—Å—Ç—Ä—ñ–π: ${STATE.human.sentiment.toFixed(0)}`, 'critical');
            } else if (STATE.human.sentiment < 40) {
                showAlert(`–ù–µ–≥–∞—Ç–∏–≤–Ω–∏–π —Å–æ—Ü—ñ–∞–ª—å–Ω–∏–π —Ñ–æ–Ω: ${STATE.human.sentiment.toFixed(0)}`, 'warning');
            }

            if (STATE.human.market > 10) {
                showAlert(`–í–∏—Å–æ–∫–∞ —Ä–∏–Ω–∫–æ–≤–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ñ—Å—Ç—å: ${STATE.human.market.toFixed(1)}%`, 'warning');
            }

            // IBONARIUM alerts
            if (STATE.ibonarium < 30) {
                showAlert(`–ö–†–ò–¢–ò–ß–ù–ò–ô –ü–õ–ê–ù–ï–¢–ê–†–ù–ò–ô –°–¢–ê–ù: IBONARIUM=${STATE.ibonarium.toFixed(1)}`, 'critical');
            } else if (STATE.ibonarium < 45) {
                showAlert(`–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω–µ –Ω–∞–ø—Ä—É–∂–µ–Ω–Ω—è: IBONARIUM=${STATE.ibonarium.toFixed(1)}`, 'warning');
            }
        }

        // ============================================================================
        // ENHANCED UI UPDATES WITH DESCRIPTIONS
        // ============================================================================

        function updateSpaceUI() {
            document.getElementById('v-kp').innerText = STATE.space.kp.toFixed(2);
            document.getElementById('v-sw-speed').innerText = STATE.space.sw_speed.toFixed(0);
            document.getElementById('v-sw-dens').innerText = STATE.space.sw_dens.toFixed(1);
            document.getElementById('v-bz').innerText = STATE.space.bz.toFixed(2);
            document.getElementById('v-bt').innerText = STATE.space.bt.toFixed(2);
            document.getElementById('space-score').innerText = STATE.space.score.toFixed(0);
            document.getElementById('space-score').style.color = getScoreColor(STATE.space.score);

            // Detailed description
            let desc = '';
            if (STATE.space.kp > 6) {
                desc = `üî¥ –ì–ï–û–ú–ê–ì–ù–Ü–¢–ù–ò–ô –®–¢–û–†–ú G${Math.floor(STATE.space.kp - 4)}: –°–∏–ª—å–Ω–µ –∑–±—É—Ä–µ–Ω–Ω—è –º–∞–≥–Ω—ñ—Ç–æ—Å—Ñ–µ—Ä–∏ –ó–µ–º–ª—ñ. –ö–†–ò–¢–ò–ß–ù–Ü –†–ò–ó–ò–ö–ò: –ø–æ—Ä—É—à–µ–Ω–Ω—è GPS-–Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (–≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –¥–æ 50–º), –∑–±–æ—ó –≤ —Ä–∞–¥—ñ–æ–∑–≤'—è–∑–∫—É –Ω–∞ –≤–∏—Å–æ–∫–∏—Ö —à–∏—Ä–æ—Ç–∞—Ö, –º–æ–∂–ª–∏–≤—ñ –ø–µ—Ä–µ–±–æ—ó –≤ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂–∞—Ö, –ø—ñ–¥–≤–∏—â–µ–Ω–∞ —Ä–∞–¥—ñ–∞—Ü—ñ—è –¥–ª—è –∞–≤—ñ–∞—Ä–µ–π—Å—ñ–≤ –Ω–∞ –ø–æ–ª—è—Ä–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤—ñ–¥–∫–ª–∞—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó.`;
            } else if (STATE.space.kp > 4) {
                desc = `üü° –ê–ö–¢–ò–í–ù–ê –§–ê–ó–ê: –ü—ñ–¥–≤–∏—â–µ–Ω–∞ –≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (Kp=${STATE.space.kp.toFixed(1)}). –û–ß–Ü–ö–£–Ñ–¢–¨–°–Ø: –ø–æ—Å–∏–ª–µ–Ω–Ω—è –ø–æ–ª—è—Ä–Ω–∏—Ö —Å—è–π–≤ –¥–æ —à–∏—Ä–æ—Ç–∏ 50-55¬∞, –º—ñ–Ω–æ—Ä–Ω—ñ –∑–±–æ—ó –≤ —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤—ñ–π –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (—Ç–æ—á–Ω—ñ—Å—Ç—å ¬±10-20–º), –º–æ–∂–ª–∏–≤—ñ —Ñ–ª—É–∫—Ç—É–∞—Ü—ñ—ó –≤ —Ä–æ–±–æ—Ç—ñ HF-—Ä–∞–¥—ñ–æ–∑–≤'—è–∑–∫—É. –ö–æ—Å–º—ñ—á–Ω–∞ –ø–æ–≥–æ–¥–∞ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∞.`;
            } else if (STATE.space.kp > 2) {
                desc = `üü¢ –ü–û–ú–Ü–†–ù–ê –ê–ö–¢–ò–í–ù–Ü–°–¢–¨: –ù–æ—Ä–º–∞–ª—å–Ω—ñ –∫–æ–ª–∏–≤–∞–Ω–Ω—è –≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–æ–≥–æ –ø–æ–ª—è (Kp=${STATE.space.kp.toFixed(1)}). –ö–æ—Å–º—ñ—á–Ω–∞ –ø–æ–≥–æ–¥–∞ –≤ –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏. –ü–æ–ª—è—Ä–Ω—ñ —Å—è–π–≤–∞ –º–æ–∂–ª–∏–≤—ñ –Ω–∞ —à–∏—Ä–æ—Ç–∞—Ö >60¬∞. –í—Å—ñ —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∞—Ü—é—é—Ç—å —à—Ç–∞—Ç–Ω–æ.`;
            } else {
                desc = `‚ö™ –°–ü–û–ö–Ü–ô: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (Kp=${STATE.space.kp.toFixed(1)}). –Ü–¥–µ–∞–ª—å–Ω—ñ —É–º–æ–≤–∏ –¥–ª—è –∫–æ—Å–º—ñ—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π, —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤–æ–≥–æ –∑–≤'—è–∑–∫—É —Ç–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó. –ú–∞–≥–Ω—ñ—Ç–æ—Å—Ñ–µ—Ä–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞.`;
            }

            if (STATE.space.sw_speed > 700) {
                desc += ` ‚ö†Ô∏è –ï–ö–°–¢–†–ï–ú–ê–õ–¨–ù–ò–ô –°–û–ù–Ø–ß–ù–ò–ô –í–Ü–¢–ï–†: ${STATE.space.sw_speed.toFixed(0)} –∫–º/—Å (–Ω–æ—Ä–º–∞ 300-400). –í–∏—Å–æ–∫–æ–µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø–ª–∞–∑–º–∏ —Å—Ç–∏—Å–∫–∞—î –º–∞–≥–Ω—ñ—Ç–æ—Å—Ñ–µ—Ä—É. –û—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ—Å–∏–ª–µ–Ω–Ω—è –≥–µ–æ–º–∞–≥–Ω—ñ—Ç–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Ç—è–≥–æ–º 6-12 –≥–æ–¥–∏–Ω.`;
            } else if (STATE.space.sw_speed > 550) {
                desc += ` –®–≤–∏–¥–∫—ñ—Å—Ç—å —Å–æ–Ω—è—á–Ω–æ–≥–æ –≤—ñ—Ç—Ä—É ${STATE.space.sw_speed.toFixed(0)} –∫–º/—Å - –ø—ñ–¥–≤–∏—â–µ–Ω–∏–π –ø–æ—Ç—ñ–∫. –ú–æ–∂–ª–∏–≤–µ –ø–æ—Å–∏–ª–µ–Ω–Ω—è –º–∞–≥–Ω—ñ—Ç–æ—Å—Ñ–µ—Ä–Ω–∏—Ö –∑–±—É—Ä–µ–Ω—å.`;
            }

            if (Math.abs(STATE.space.bz) > 10) {
                const direction = STATE.space.bz < 0 ? '–ø—ñ–≤–¥–µ–Ω–Ω–∞ (–ù–ï–ë–ï–ó–ü–ï–ß–ù–ê)' : '–ø—ñ–≤–Ω—ñ—á–Ω–∞ (—Å—Ç–∞–±—ñ–ª—ñ–∑—É—é—á–∞)';
                desc += ` Bz –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ IMF: ${STATE.space.bz.toFixed(1)} nT (${direction}). ${STATE.space.bz < 0 ? '–ü—ñ–≤–¥–µ–Ω–Ω–∞ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è —Å–ø—Ä–∏—è—î –º–∞–≥–Ω—ñ—Ç–Ω–∏–º –±—É—Ä—è–º!' : ''}`;
            }

            document.getElementById('space-desc').innerText = desc;
        }

        function updateEarthUI() {
            document.getElementById('v-temp').innerText = STATE.earth.temp.toFixed(1);
            document.getElementById('v-press').innerText = STATE.earth.press.toFixed(0);
            document.getElementById('v-hum').innerText = STATE.earth.hum.toFixed(0);
            document.getElementById('v-wind').innerText = STATE.earth.wind.toFixed(1);
            document.getElementById('v-uv').innerText = STATE.earth.uv.toFixed(1);
            document.getElementById('v-aqi').innerText = STATE.earth.aqi.toFixed(0);
            document.getElementById('earth-score').innerText = STATE.earth.score.toFixed(0);
            document.getElementById('earth-score').style.color = getScoreColor(STATE.earth.score);

            // Detailed description
            let desc = `üìç –ö–ò–á–í: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${STATE.earth.temp.toFixed(1)}¬∞C `;

            // Temperature analysis
            if (STATE.earth.temp < -15) {
                desc += `(–ï–ö–°–¢–†–ï–ú–ê–õ–¨–ù–ò–ô –•–û–õ–û–î - —Ä–∏–∑–∏–∫ –ø–µ—Ä–µ–æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è), `;
            } else if (STATE.earth.temp < 0) {
                desc += `(—Ö–æ–ª–æ–¥–Ω–æ - –æ–±–µ—Ä–µ–∂–Ω–æ –∑ –æ–∂–µ–ª–µ–¥–∏—Ü–µ—é), `;
            } else if (STATE.earth.temp > 30) {
                desc += `(–°–ü–ï–ö–ê - —Ä–∏–∑–∏–∫ —Ç–µ–ø–ª–æ–≤–æ–≥–æ —É–¥–∞—Ä—É), `;
            } else if (STATE.earth.temp > 25) {
                desc += `(—Ç–µ–ø–ª–æ), `;
            } else {
                desc += `(–∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞), `;
            }

            // Pressure analysis
            if (STATE.earth.press < 980) {
                desc += `–ù–ò–ó–¨–ö–ò–ô –¢–ò–°–ö ${STATE.earth.press.toFixed(0)} hPa (–≥–ª–∏–±–æ–∫–∏–π —Ü–∏–∫–ª–æ–Ω). –û–ß–Ü–ö–£–Ñ–¢–¨–°–Ø: —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ –æ–ø–∞–¥–∏, –ø–æ—Å–∏–ª–µ–Ω–Ω—è –≤—ñ—Ç—Ä—É. `;
            } else if (STATE.earth.press < 1000) {
                desc += `–∑–Ω–∏–∂–µ–Ω–∏–π —Ç–∏—Å–∫ ${STATE.earth.press.toFixed(0)} hPa (—Ü–∏–∫–ª–æ–Ω, –º–æ–∂–ª–∏–≤—ñ –æ–ø–∞–¥–∏). `;
            } else if (STATE.earth.press > 1030) {
                desc += `–í–ò–°–û–ö–ò–ô –¢–ò–°–ö ${STATE.earth.press.toFixed(0)} hPa (–∞–Ω—Ç–∏—Ü–∏–∫–ª–æ–Ω, —è—Å–Ω–æ). `;
            } else if (STATE.earth.press > 1020) {
                desc += `–ø—ñ–¥–≤–∏—â–µ–Ω–∏–π —Ç–∏—Å–∫ ${STATE.earth.press.toFixed(0)} hPa (–∞–Ω—Ç–∏—Ü–∏–∫–ª–æ–Ω). `;
            } else {
                desc += `–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ç–∏—Å–∫ ${STATE.earth.press.toFixed(0)} hPa. `;
            }

            // Wind analysis
            if (STATE.earth.wind > 20) {
                desc += `‚ö†Ô∏è –®–¢–û–†–ú–û–í–ò–ô –í–Ü–¢–ï–† ${STATE.earth.wind.toFixed(1)} –º/—Å! –ù–ï–ë–ï–ó–ü–ï–ß–ù–û.`;
            } else if (STATE.earth.wind > 15) {
                desc += `‚ö†Ô∏è –°–ò–õ–¨–ù–ò–ô –í–Ü–¢–ï–† ${STATE.earth.wind.toFixed(1)} –º/—Å.`;
            } else if (STATE.earth.wind > 12) {
                desc += `‚ö†Ô∏è –°–∏–ª—å–Ω–∏–π –≤—ñ—Ç–µ—Ä ${STATE.earth.wind.toFixed(1)} –º/—Å.`;
            } else if (STATE.earth.wind > 7) {
                desc += `–ü–æ–º—ñ—Ä–Ω–∏–π –≤—ñ—Ç–µ—Ä ${STATE.earth.wind.toFixed(1)} –º/—Å.`;
            } else {
                desc += `–°–ª–∞–±–∫–∏–π –≤—ñ—Ç–µ—Ä ${STATE.earth.wind.toFixed(1)} –º/—Å.`;
            }

            document.getElementById('earth-desc').innerText = desc;
        }

        function updateHumanUI() {
            document.getElementById('v-sentiment').innerText = STATE.human.sentiment.toFixed(0);
            document.getElementById('v-market').innerText = STATE.human.market.toFixed(1) + '%';
            document.getElementById('v-social').innerText = STATE.human.social.toFixed(0);
            document.getElementById('v-conflict').innerText = STATE.human.conflict.toFixed(0);
            document.getElementById('human-score').innerText = STATE.human.score.toFixed(0);
            document.getElementById('human-score').style.color = getScoreColor(STATE.human.score);

            // Detailed description
            let desc = '';
            if (STATE.human.sentiment < 30) {
                desc = `üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô –ù–ï–ì–ê–¢–ò–í (${STATE.human.sentiment.toFixed(0)}/100): –î–æ–º—ñ–Ω—É—é—Ç—å —Ç—Ä–∏–≤–æ–∂–Ω—ñ –Ω–æ–≤–∏–Ω–∏ - –≤—ñ–π–Ω–∞, —Å–º–µ—Ä—Ç—å, –∫—Ä–∏–∑–∏, –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏. –ö–û–õ–ï–ö–¢–ò–í–ù–ê –ü–°–ò–•–Ü–ö–ê –ü–Ü–î –¢–ò–°–ö–û–ú. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –Ω–∞—Å–∏—á–µ–Ω–∏–π —Å—Ç—Ä–∞—Ö–æ–º —Ç–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –æ–±–º–µ–∂–∏—Ç–∏ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –Ω–æ–≤–∏–Ω –¥–ª—è –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è.`;
            } else if (STATE.human.sentiment < 45) {
                desc = `üü° –ü–ï–°–ò–ú–Ü–°–¢–ò–ß–ù–ò–ô –§–û–ù (${STATE.human.sentiment.toFixed(0)}/100): –ü–µ—Ä–µ–≤–∞–∂–∞—é—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ –ø–æ–¥—ñ—ó –≤ —Å–≤—ñ—Ç–æ–≤–∏—Ö –ó–ú–Ü. –°–æ—Ü—ñ–∞–ª—å–Ω–∞ –Ω–∞–ø—Ä—É–≥–∞ –∑—Ä–æ—Å—Ç–∞—î. –§—ñ–∫—Å—É—î—Ç—å—Å—è –ø—ñ–¥–≤–∏—â–µ–Ω–∞ —Ç—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å —É —Å—É—Å–ø—ñ–ª—å—Å—Ç–≤—ñ. –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.`;
            } else if (STATE.human.sentiment < 60) {
                desc = `üü¢ –ù–ï–ô–¢–†–ê–õ–¨–ù–ò–ô –ë–ê–õ–ê–ù–° (${STATE.human.sentiment.toFixed(0)}/100): –ó–º—ñ—à–∞–Ω–∏–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –ø–æ—Ç—ñ–∫ - —è–∫ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ, —Ç–∞–∫ —ñ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ –ø–æ–¥—ñ—ó. –°—Ç–∞–±—ñ–ª—å–Ω–∏–π —Å–æ—Ü—ñ–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –≤—ñ–¥—Ö–∏–ª–µ–Ω—å.`;
            } else {
                desc = `‚ö™ –û–ü–¢–ò–ú–Ü–°–¢–ò–ß–ù–ò–ô –ù–ê–°–¢–†–Ü–ô (${STATE.human.sentiment.toFixed(0)}/100): –ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –Ω–æ–≤–∏–Ω–∏ –ø–µ—Ä–µ–≤–∞–∂–∞—é—Ç—å - –º–∏—Ä, –¥–æ–ø–æ–º–æ–≥–∞, –ø—Ä–æ–≥—Ä–µ—Å, –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∏–π —Å–æ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–ª—ñ–º–∞—Ç —Å–ø—Ä–∏—è—î —Ä–æ–∑–≤–∏—Ç–∫—É.`;
            }

            // Market analysis
            if (STATE.human.market > 15) {
                desc += ` ‚ö†Ô∏è –ï–ö–°–¢–†–ï–ú–ê–õ–¨–ù–ê –†–ò–ù–ö–û–í–ê –í–û–õ–ê–¢–ò–õ–¨–ù–Ü–°–¢–¨: ${STATE.human.market.toFixed(1)}% (Bitcoin 24h). –ü–∞–Ω—ñ–∫–∞ –∞–±–æ –µ–π—Ñ–æ—Ä—ñ—è –Ω–∞ –∫—Ä–∏–ø—Ç–æ—Ä–∏–Ω–∫–∞—Ö. –í–∏—Å–æ–∫—ñ —Ä–∏–∑–∏–∫–∏.`;
            } else if (STATE.human.market > 10) {
                desc += ` –í–ò–°–û–ö–ê –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ñ—Å—Ç—å: ${STATE.human.market.toFixed(1)}% (Bitcoin 24h). –ù–µ—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö —Ä–∏–Ω–∫—ñ–≤.`;
            } else if (STATE.human.market > 5) {
                desc += ` –ü–æ–º—ñ—Ä–Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ñ—Å—Ç—å: ${STATE.human.market.toFixed(1)}% (Bitcoin 24h). –ù–æ—Ä–º–∞–ª—å–Ω—ñ —Ä–∏–Ω–∫–æ–≤—ñ –∫–æ–ª–∏–≤–∞–Ω–Ω—è.`;
            } else {
                desc += ` –ù–∏–∑—å–∫–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ñ—Å—Ç—å: ${STATE.human.market.toFixed(1)}% (Bitcoin 24h). –†–∏–Ω–∫–∏ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ.`;
            }

            document.getElementById('human-desc').innerText = desc;
        }

        function updateMainUI() {
            const idx = STATE.ibonarium;
            document.getElementById('main-idx').innerText = idx.toFixed(1);
            document.getElementById('main-idx').style.color = getScoreColor(idx);

            let mood = "";
            let fullDesc = "";

            if (idx < 30) {
                mood = "–ö–†–ò–¢–ò–ß–ù–ò–ô –°–¢–ê–ù";
                fullDesc = "–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—ñ–¥ –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏–º —Ç–∏—Å–∫–æ–º. –í–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å –∫–æ—Å–º—ñ—á–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏—Ö –∞–Ω–æ–º–∞–ª—ñ–π —Ç–∞ —Å–æ—Ü—ñ–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—É. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—ñ–¥–≤–∏—â–µ–Ω–∞ –æ–±–µ—Ä–µ–∂–Ω—ñ—Å—Ç—å.";
            } else if (idx < 50) {
                mood = "–ù–ê–ü–†–£–ñ–ï–ù–ù–Ø";
                fullDesc = "–í–∏—è–≤–ª–µ–Ω–æ –∑–Ω–∞—á–Ω—ñ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤ –æ–¥–Ω–æ–º—É –∞–±–æ –∫—ñ–ª—å–∫–æ—Ö —à–∞—Ä–∞—Ö. –ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤ —Å—Ç–∞–Ω—ñ –¥–∏—Å–±–∞–ª–∞–Ω—Å—É. –û—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ—Å–∏–ª–µ–Ω–Ω—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ.";
            } else if (idx < 70) {
                mood = "–°–¢–ê–ë–Ü–õ–¨–ù–Ü–°–¢–¨";
                fullDesc = "–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏. –õ–æ–∫–∞–ª—å–Ω—ñ —Ñ–ª—É–∫—Ç—É–∞—Ü—ñ—ó –ø—Ä–∏—Å—É—Ç–Ω—ñ, –∞–ª–µ –∑–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π. –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è.";
            } else {
                mood = "–ì–ê–†–ú–û–ù–Ü–Ø";
                fullDesc = "–û–ø—Ç–∏–º–∞–ª—å–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö —à–∞—Ä—ñ–≤. –ö–æ—Å–º–æ—Å, –ó–µ–º–ª—è —Ç–∞ –°–æ—Ü—ñ—É–º –≤ –±–∞–ª–∞–Ω—Å—ñ. –°–ø—Ä–∏—è—Ç–ª–∏–≤—ñ —É–º–æ–≤–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∏–¥—ñ–≤ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ.";
            }

            document.getElementById('main-desc').innerHTML = `<span style="color:#fff; font-weight:bold">${mood}</span> // ${fullDesc}`;

            // Analytics
            const vals = STATE.history.map(h => h.val);
            const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
            const dev = Math.sqrt(vals.map(v => Math.pow(v - avg, 2)).reduce((a, b) => a + b, 0) / vals.length);
            const trend = vals[vals.length - 1] > vals[vals.length - 10] ? '‚Üó –ó–†–û–°–¢–ê–ù–ù–Ø' : '‚Üò –°–ü–ê–î';

            document.getElementById('m-avg').innerText = avg.toFixed(1);
            document.getElementById('m-dev').innerText = dev.toFixed(1);
            document.getElementById('m-trend').innerText = trend;
            document.getElementById('m-peak').innerText = new Date().toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });

            // Check alerts
            checkAlerts();
        }

        function getScoreColor(score) {
            if (score < 30) return '#f04';
            if (score < 50) return '#fa0';
            if (score < 70) return '#ff0';
            return '#0fa';
        }

        // ============================================================================
        // UTILS
        // ============================================================================

        function clamp(v, min, max) {
            return Math.max(min, Math.min(max, v));
        }

        function tickClock() {
            const now = new Date();
            elClock.innerText = now.toLocaleTimeString('uk-UA');
        }

        function log(msg) {
            const t = new Date().toLocaleTimeString('uk-UA', { hour12: false });
            const d = document.createElement('div');
            d.className = 'log-entry';
            d.innerHTML = `<span class="log-time">[${t}]</span> ${msg}`;
            elLog.prepend(d);
            if (elLog.children.length > 20) elLog.lastChild.remove();
        }

        // Background stars
        const bgC = document.getElementById('bg-stars');
        const bgCtx = bgC.getContext('2d');
        let stars = [];
        for (let i = 0; i < 150; i++) {
            stars.push({
                x: Math.random() * innerWidth,
                y: Math.random() * innerHeight,
                s: Math.random() * 1.5,
                a: Math.random()
            });
        }

        function animStars() {
            bgC.width = innerWidth;
            bgC.height = innerHeight;
            bgCtx.clearRect(0, 0, innerWidth, innerHeight);
            bgCtx.fillStyle = '#fff';
            stars.forEach(s => {
                bgCtx.globalAlpha = s.a * 0.4;
                bgCtx.beginPath();
                bgCtx.arc(s.x, s.y, s.s, 0, Math.PI * 2);
                bgCtx.fill();
                s.y += 0.1;
                if (s.y > innerHeight) s.y = 0;
            });
            requestAnimationFrame(animStars);
        }
        animStars();

        // Auto-recalculate IBONARIUM after any data update
        setInterval(() => {
            calculateIBONARIUM();
        }, 5000);

        init();
    </script>
</body>

</html>
